<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="FullStreamRec: Cuentas Premium de Netflix, Disney+, Spotify, IPTV y Recargas Free Fire en Ecuador. Entrega inmediata.">
  <meta name="keywords" content="Netflix Ecuador, Disney+, Spotify, IPTV, Free Fire, streaming barato, recargas juegos">
  <meta name="author" content="FullStreamRec">
  <meta name="theme-color" content="#09090b">
  <meta property="og:title" content="FullStreamRec | Streaming Premium Ecuador">
  <meta property="og:image" content="logo.jpg">
  <meta property="og:url" content="https://fullstreamrec.com">
  <meta property="og:type" content="website">
  <title>FullStreamRec | Streaming y Juegos</title>
  <link rel="icon" type="image/x-icon" href="logo.ico">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            brand: {
              DEFAULT: '#ff5e66',
              hover: '#ff444d',
              light: '#ff8a90'
            },
            dark: {
              950: '#09090b',
              900: '#121214',
              800: '#1c1c1f',
              700: '#27272a',
            }
          },
          boxShadow: {
            'glow': '0 0 20px -5px rgba(255, 94, 102, 0.3)',
          }
        }
      }
    }
  </script>

  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

  <style>
    body { background-color: #09090b; }
    .no-scroll { overflow: hidden; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    .carousel-container {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      gap: 1.5rem;
      padding: 1rem 1.5rem;
      -webkit-overflow-scrolling: touch;
    }

    .carousel-container::-webkit-scrollbar { height: 8px; }
    .carousel-container::-webkit-scrollbar-track { background: #1c1c1f; border-radius: 10px; }
    .carousel-container::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 10px; }
    .carousel-container::-webkit-scrollbar-thumb:hover { background: #52525b; }

    .carousel-card { flex: 0 0 280px; scroll-snap-align: start; }
    @media (max-width: 640px) { .carousel-card { flex: 0 0 240px; } }

    .skeleton-card { animation: shimmer 2s infinite; }
    @keyframes shimmer {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    /* Animación de entrada y salida tipo valla publicitaria */
.hero-ad-transition {
  transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.hero-ad-hidden {
  opacity: 0;
  transform: translateY(20px);
  filter: blur(10px);
}

/* Efecto de transición para valla publicitaria individual */
.valla-container {
  perspective: 1000px;
}

.valla-card {
  transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Estado cuando el producto está saliendo o entrando */
.valla-hidden {
  opacity: 0;
  transform: rotateX(-15deg) translateY(30px) scale(0.9);
  filter: blur(8px);
}

/* Brillo de barrido tipo LED */
.led-glow {
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transform: translateX(-100%);
  animation: led-sweep 3s infinite;
}

@keyframes led-sweep {
  100% { transform: translateX(100%); }
}

@keyframes marquee {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

.animate-marquee {
  display: flex;
  width: max-content;
  animation: marquee 30s linear infinite;
}

.marquee-container::before,
.marquee-container::after {
  content: "";
  position: absolute;
  top: 0;
  width: 100px;
  height: 100%;
  z-index: 2;
  pointer-events: none;
}

.marquee-container::before {
  left: 0;
  background: linear-gradient(to right, #09090b, transparent);
}

.marquee-container::after {
  right: 0;
  background: linear-gradient(to left, #09090b, transparent);
}
  </style>
</head>

<body class="text-zinc-100 antialiased selection:bg-brand/30 selection:text-white">
  <!-- Header -->
  <header class="fixed top-0 w-full z-50 bg-dark-950/80 backdrop-blur-xl border-b border-white/5 transition-all duration-300 supports-[backdrop-filter]:bg-dark-950/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16 md:h-20">

        <div class="flex-shrink-0 flex items-center gap-3 cursor-pointer group" onclick="window.scrollTo(0,0)">
          <div class="relative">
            <div class="absolute -inset-1 bg-brand rounded-lg blur opacity-25 group-hover:opacity-50 transition duration-200"></div>
            <img src="logo.jpg" alt="FullStreamRec" class="relative h-10 w-10 rounded-lg object-cover">
          </div>
          <span class="font-extrabold text-xl tracking-tight text-white">FullStream<span class="text-brand">Rec</span></span>
        </div>

        <nav id="main-nav" class="hidden md:flex items-center space-x-1 transition-all duration-300">
          <a href="index.html" class="px-4 py-2 rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-all font-medium text-sm uppercase tracking-wider">Inicio</a>
          <a href="sobre-nosotros.html" class="px-4 py-2 rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-all font-medium text-sm uppercase tracking-wider">Nosotros</a>
          <a href="contacto.html" class="px-4 py-2 rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-all font-medium text-sm uppercase tracking-wider">Contacto</a>
          <a href="faq.html" class="px-4 py-2 rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-all font-medium text-sm uppercase tracking-wider">FAQ</a>
        </nav>

        <div class="flex items-center gap-4 md:gap-6">

          <div id="guest-menu" class="hidden">
            <button onclick="loginWithGoogle()" class="flex items-center gap-2 bg-white text-dark-950 px-4 py-2 rounded-full font-bold text-xs hover:bg-zinc-200 transition-all shadow-lg hover:scale-105">
              <i class="fab fa-google"></i> Ingresar
            </button>
          </div>

          <div id="user-menu" class="hidden items-center gap-3 animate-fade-in">
            <img id="user-photo" src="" alt="User" class="h-8 w-8 rounded-full border border-brand/50 object-cover shadow-glow">
            <a href="mis-pedidos.html" class="hidden md:inline-flex items-center text-xs text-zinc-300 hover:text-brand font-bold bg-dark-800 border border-zinc-700 px-3 py-1.5 rounded-lg transition-all">
              <i class="fas fa-box-open mr-1"></i> Mis Pedidos
            </a>
            <button onclick="logout()" class="hidden md:block text-xs bg-dark-800 hover:bg-red-500/20 text-zinc-300 hover:text-red-500 border border-zinc-700 px-3 py-1.5 rounded-lg transition-all font-medium">
              <span class="flex items-center gap-2">Salir <i class="fas fa-sign-out-alt"></i></span>
            </button>
          </div>

          <div class="relative cursor-pointer group p-2" id="cartIcon">
            <i class="fas fa-shopping-cart text-xl text-zinc-300 group-hover:text-brand transition-colors"></i>
            <span id="cartCount" class="absolute top-0 right-0 bg-brand text-white text-[10px] font-bold h-5 w-5 flex items-center justify-center rounded-full border-2 border-dark-950 animate-pulse">0</span>
          </div>

          <button id="hamburger" class="md:hidden p-2 text-zinc-300 hover:text-white focus:outline-none">
            <i class="fas fa-bars text-2xl"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobileMenu" class="hidden md:hidden bg-dark-900 border-b border-white/5 transition-all">
      <div class="px-4 pt-2 pb-4 space-y-2">
        <div id="mobile-nav-links" class="space-y-2">
          <a href="index.html" class="block px-4 py-3 rounded-xl text-base font-bold text-brand bg-brand/10 border border-brand/20">Inicio</a>
          <a href="sobre-nosotros.html" class="block px-4 py-3 rounded-xl text-base font-medium text-zinc-400 hover:bg-dark-800 hover:text-white transition-all">Sobre Nosotros</a>
          <a href="contacto.html" class="block px-4 py-3 rounded-xl text-base font-medium text-zinc-400 hover:bg-dark-800 hover:text-white transition-all">Contacto</a>
          <a href="faq.html" class="block px-4 py-3 rounded-xl text-base font-medium text-zinc-400 hover:bg-dark-800 hover:text-white transition-all">FAQ</a>
        </div>

        <a id="mobile-orders-btn" href="mis-pedidos.html" class="hidden w-full mt-2 flex items-center justify-center gap-2 bg-dark-800 text-zinc-200 border border-zinc-700 px-4 py-3 rounded-xl font-bold text-sm hover:bg-dark-700 hover:text-white transition-all">
          <i class="fas fa-box-open"></i> Mis Pedidos
        </a>

        <button id="mobile-guest-btn" onclick="loginWithGoogle()" class="w-full mt-4 flex items-center justify-center gap-2 bg-white text-dark-950 px-4 py-3 rounded-xl font-bold text-sm hover:bg-zinc-200 transition-all">
          <i class="fab fa-google"></i> Iniciar Sesión
        </button>

        <button id="mobile-logout-btn" onclick="logout()" class="hidden w-full mt-4 flex items-center justify-center gap-2 bg-red-500/10 border border-red-500/50 text-red-500 px-4 py-3 rounded-xl font-bold text-sm hover:bg-red-500 hover:text-white transition-all">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </button>
      </div>
    </div>
  </header>

  <!-- Hero -->
<section class="relative pt-36 pb-10 lg:pt-48 lg:pb-20 overflow-hidden">
  <div class="absolute top-0 left-1/2 w-full -translate-x-1/2 h-full z-0 pointer-events-none select-none">
    <div class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] bg-brand/20 rounded-full blur-[150px] opacity-40 mix-blend-screen"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[150px] opacity-40 mix-blend-screen"></div>
  </div>

  <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Grid: Contenido + Visual -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <!-- Contenido Izquierda -->
      <div class="text-center lg:text-left">
        <div class="inline-flex items-center gap-2 bg-brand/20 border border-brand/40 rounded-full px-4 py-2 mb-6 lg:justify-start">
          <i class="fas fa-fire text-brand text-sm"></i>
          <span class="text-sm font-bold text-brand">Ofertas Limitadas</span>
        </div>

        <h1 id="hero-title" class="text-5xl md:text-6xl font-black tracking-tighter text-white mb-6 leading-tight">
          Entretenimiento <br/>
          <span class="bg-clip-text text-transparent bg-gradient-to-r from-brand via-brand-light to-orange-400">Al Mejor Precio</span>
        </h1>

        <p id="hero-desc" class="text-lg text-zinc-300 mb-8 leading-relaxed">
          Netflix, Disney+, Spotify, IPTV y más. Acceso inmediato a todos tus servicios favoritos con descuentos exclusivos de hasta 40%.
        </p>

        <!-- Stats en dos columnas -->
        <div id="hero-stats" class="grid grid-cols-2 gap-4 mb-8">
          <div class="bg-dark-800/30 border border-zinc-700/30 rounded-xl p-4">
            <div class="text-2xl font-black text-brand">2.5K+</div>
            <p class="text-xs text-zinc-400">Clientes Activos</p>
          </div>
          <div class="bg-dark-800/30 border border-zinc-700/30 rounded-xl p-4">
            <div class="text-2xl font-black text-green-500">&lt; 1 min</div>
            <p class="text-xs text-zinc-400">Activación</p>
          </div>
        </div>

        <!-- Botones -->
        <div id="hero-buttons" class="flex flex-col sm:flex-row gap-4 justify-start lg:justify-start">
          <button onclick="showCatalogModal()" class="group inline-flex h-14 items-center justify-center gap-2 rounded-full bg-gradient-to-r from-brand to-red-500 px-8 font-bold text-white transition-all hover:brightness-110 shadow-lg shadow-brand/30 hover:-translate-y-1 active:scale-95">
            <i class="fas fa-play text-sm"></i> Ver Catálogo
          </button>

          <a href="https://wa.me/593978652638" target="_blank" class="group inline-flex h-14 items-center justify-center gap-2 rounded-full border-2 border-green-500/50 bg-green-500/10 px-8 font-bold text-green-500 hover:bg-green-500/20 transition-all hover:-translate-y-1">
            <i class="fab fa-whatsapp"></i> Chat
          </a>
        </div>
      </div>

     <!-- Visual Derecha -->
<div class="mt-8 lg:mt-0 w-full valla-container">
  <div id="hero-products-container" class="relative h-[140px] w-full max-w-sm mx-auto lg:max-w-none">
    </div>
</div>
        </div>
      </div>
    </div>
  </div>
</section>


  <!-- Main -->
  <main class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 pb-32 relative z-10">
    <div id="search-container" class="hidden max-w-2xl mx-auto mb-16 animate-fade-in">
      <div class="relative group">
        <div class="absolute -inset-1 bg-gradient-to-r from-brand to-purple-600 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-200"></div>
        <div class="relative">
          <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-brand transition-colors"></i>
          <input type="text" id="searchInput" placeholder="¿Qué estás buscando hoy? (Ej: Netflix, Free Fire...)"
            class="w-full bg-dark-900 border border-zinc-700 text-white text-lg rounded-xl pl-14 pr-4 py-4 focus:border-brand focus:ring-1 focus:ring-brand focus:outline-none transition-all placeholder-zinc-600 shadow-2xl">
        </div>
      </div>
    </div>

    <div id="products-container" class="min-h-[500px]"></div>
  </main>

  <!-- Footer -->
  <footer id="main-footer" class="bg-dark-900 border-t border-white/5 pt-20 pb-10 relative overflow-hidden">
    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[800px] h-[300px] bg-brand/5 blur-[100px] pointer-events-none"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-12 lg:gap-16 mb-16">
        <div class="md:col-span-5">
          <div class="flex items-center gap-3 mb-6">
            <img src="logo.jpg" class="h-10 w-10 rounded-lg shadow-glow" alt="Logo">
            <span class="text-2xl font-extrabold text-white">FullStream<span class="text-brand">Rec</span></span>
          </div>
          <p class="text-zinc-400 text-base leading-relaxed mb-8 pr-4">Tu proveedor de confianza en Ecuador.</p>
          <div class="flex gap-4">
            <a href="#" class="h-12 w-12 rounded-full bg-dark-800 border border-white/5 flex items-center justify-center text-zinc-400 hover:bg-brand hover:border-brand hover:text-white transition-all group"><i class="fab fa-facebook-f text-xl group-hover:scale-110 transition-transform"></i></a>
            <a href="#" class="h-12 w-12 rounded-full bg-dark-800 border border-white/5 flex items-center justify-center text-zinc-400 hover:bg-brand hover:border-brand hover:text-white transition-all group"><i class="fab fa-instagram text-xl group-hover:scale-110 transition-transform"></i></a>
            <a href="https://wa.me/593978652638" class="h-12 w-12 rounded-full bg-dark-800 border border-white/5 flex items-center justify-center text-zinc-400 hover:bg-green-600 hover:border-green-600 hover:text-white transition-all group"><i class="fab fa-whatsapp text-xl group-hover:scale-110 transition-transform"></i></a>
          </div>
        </div>

        <div class="md:col-span-3 md:pl-8">
          <h3 class="text-white font-bold mb-6 uppercase tracking-wider text-sm">Menú</h3>
          <ul class="space-y-4">
            <li><a href="index.html" class="text-zinc-400 hover:text-brand font-medium transition-colors flex items-center gap-2">Inicio</a></li>
            <li><a href="sobre-nosotros.html" class="text-zinc-400 hover:text-brand font-medium transition-colors flex items-center gap-2">Nosotros</a></li>
            <li><a href="contacto.html" class="text-zinc-400 hover:text-brand font-medium transition-colors flex items-center gap-2">Contacto</a></li>
            <li><a href="faq.html" class="text-zinc-400 hover:text-brand font-medium transition-colors flex items-center gap-2">FAQ</a></li>
          </ul>
        </div>

        <div class="md:col-span-4">
          <h3 class="text-white font-bold mb-6 uppercase tracking-wider text-sm">Contacto</h3>
          <ul class="space-y-6">
            <li class="flex items-start gap-4 group">
              <div class="h-10 w-10 rounded-lg bg-dark-800 flex items-center justify-center text-brand group-hover:bg-brand group-hover:text-white transition-colors shrink-0">
                <i class="fas fa-phone-alt"></i>
              </div>
              <div>
                <p class="text-white font-bold">WhatsApp</p>
                <p class="text-zinc-400 text-sm">+593 97 865 2638</p>
              </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
        <p class="text-zinc-500 text-sm text-center md:text-left font-medium">&copy; 2025 FullStreamRec.</p>
      </div>
    </div>
  </footer>

  <!-- Global modal -->
  <div id="globalModal" class="fixed inset-0 z-[60] hidden" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-dark-950/80 backdrop-blur-md transition-opacity" id="modalOverlay"></div>
    <div class="relative w-full h-full flex items-center justify-center p-4 sm:p-6">
      <div class="bg-dark-900/90 border border-white/10 w-full max-w-xl max-h-[85vh] rounded-3xl shadow-2xl shadow-black/50 flex flex-col animate-fade-in overflow-hidden supports-[backdrop-filter]:backdrop-blur-xl">
        <div class="flex items-center justify-between p-6 border-b border-white/5 bg-dark-900/50">
          <div class="flex items-center gap-4">
            <div class="p-2 bg-dark-800 rounded-xl border border-white/5">
              <img id="global-modal-logo" src="" class="w-12 h-12 object-contain" alt="">
            </div>
            <div>
              <h3 id="global-modal-title" class="text-xl font-black text-white tracking-tight leading-none"></h3>
              <p class="text-zinc-400 text-sm mt-1">Selecciona tu plan ideal</p>
            </div>
          </div>
          <button class="global-modal-close text-zinc-400 hover:text-white bg-dark-800 hover:bg-brand p-2 rounded-full transition-all">
            <i class="fas fa-times text-lg w-6 h-6 flex items-center justify-center"></i>
          </button>
        </div>
        <div id="global-plans-container" class="p-6 overflow-y-auto scrollbar-hide space-y-4"></div>
      </div>
    </div>
  </div>

  <!-- Cart modal -->
  <div id="cartModal" class="fixed inset-0 z-[70] hidden" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-dark-950/80 backdrop-blur-sm transition-opacity close-cart"></div>
    <div class="absolute right-0 top-0 h-full w-full max-w-[450px] bg-dark-900 border-l border-white/10 shadow-2xl transform transition-transform flex flex-col supports-[backdrop-filter]:backdrop-blur-xl bg-dark-900/95">
      <div class="flex items-center justify-between p-6 border-b border-white/5">
        <div>
          <h3 class="text-2xl font-black text-white flex items-center gap-3">
            <i class="fas fa-shopping-bag text-brand"></i> Tu Carrito
          </h3>
          <p class="text-zinc-400 text-sm mt-1">Revisa tus items antes de finalizar</p>
        </div>
        <button class="close-cart text-zinc-400 hover:text-white bg-dark-800 hover:bg-brand p-2 rounded-full transition-all">
          <i class="fas fa-times text-lg w-6 h-6 flex items-center justify-center"></i>
        </button>
      </div>

      <div id="cartItems" class="flex-1 overflow-y-auto p-6 space-y-4 scrollbar-hide bg-dark-900/50"></div>

      <div class="p-6 border-t border-white/5 bg-dark-900 relative">
        <div class="absolute -top-6 left-0 w-full h-6 bg-gradient-to-t from-dark-900 to-transparent pointer-events-none"></div>

        <div class="flex justify-between items-end mb-6">
          <span class="text-zinc-400 font-medium">Total estimado:</span>
          <span id="cartTotal" class="text-3xl font-black text-white tracking-tight">$0.00</span>
        </div>

        <button id="btn-process-checkout" onclick="openPaymentModal()" class="group w-full py-4 bg-gradient-to-r from-brand to-red-500 hover:brightness-110 text-white font-bold rounded-2xl flex items-center justify-center gap-3 transition-all shadow-lg shadow-brand/20 active:scale-95">
          <span>Procesar Pedido</span>
          <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Phone modal -->
  <div id="phoneModal" class="fixed inset-0 z-[85] hidden flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closePhoneModal(false)"></div>

    <div class="relative bg-dark-900 border border-zinc-700 w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-fade-in">
      <div class="bg-brand/10 p-6 text-center border-b border-white/5">
        <div class="w-16 h-16 bg-brand rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl shadow-lg shadow-brand/30">
          <i class="fas fa-phone"></i>
        </div>
        <h3 class="text-2xl font-black text-white">Número de WhatsApp</h3>
        <p class="text-zinc-400 text-sm">Es obligatorio para ubicar tu pedido y contactarte.</p>
      </div>

      <div class="p-6 space-y-4">
        <div class="bg-dark-950 p-4 rounded-xl border border-zinc-800">
          <label class="block text-xs font-bold text-zinc-400 uppercase mb-2">Ecuador</label>

          <div class="flex gap-2">
            <div class="shrink-0 px-3 py-3 rounded-xl bg-dark-800 border border-zinc-700 text-zinc-300 font-bold">+593</div>
            <input type="tel" id="phoneInput" inputmode="numeric" autocomplete="tel" placeholder="Ej: 0912345678"
              class="flex-1 w-full bg-dark-900 border border-zinc-600 rounded-xl px-4 py-3 text-white focus:border-brand focus:outline-none transition-all" />
          </div>

          <p class="text-[11px] text-zinc-500 mt-2">Formato: 09xxxxxxxx (10 dígitos).</p>
          <p id="phoneError" class="hidden text-xs text-red-500 mt-2 font-bold">
            Número inválido. Debe iniciar con 09 y tener 10 dígitos.
          </p>
        </div>

        <button id="btn-save-phone"
          class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/20 transition-all flex items-center justify-center gap-2 active:scale-95">
          <span>Guardar y continuar</span>
          <i class="fas fa-check-circle"></i>
        </button>

        <button class="w-full py-3 bg-dark-800 hover:bg-dark-700 text-zinc-300 font-bold rounded-xl border border-zinc-700 transition-all"
          onclick="closePhoneModal(false)">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Payment modal -->
  <div id="paymentModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="document.getElementById('paymentModal').classList.add('hidden')"></div>
    <div class="relative bg-dark-900 border border-zinc-700 w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-fade-in transform transition-all">
      <div class="bg-brand/10 p-6 text-center border-b border-white/5">
        <div class="w-16 h-16 bg-brand rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl shadow-lg shadow-brand/30">
          <i class="fas fa-wallet"></i>
        </div>
        <h3 class="text-2xl font-black text-white">Casi listo</h3>
        <p class="text-zinc-400 text-sm">Realiza el pago para activar tu servicio</p>
      </div>

      <div class="p-6 space-y-5">
        <div class="space-y-3">
          <div class="p-4 bg-dark-950 rounded-xl border border-zinc-800 flex items-center justify-between group hover:border-brand/30 transition-colors">
            <div>
              <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-wider">Banco Pichincha</p>
              <p class="text-white font-mono font-bold text-lg">2210925922</p>
              <p class="text-xs text-zinc-400">Ahorros - Luis Fernando Avilez Cevallos</p>
            </div>
            <button class="text-zinc-500 hover:text-white bg-dark-800 p-2 rounded-lg transition-colors" onclick="navigator.clipboard.writeText('2210925922'); alert('Copiado!')">
              <i class="far fa-copy"></i>
            </button>
          </div>

          <div class="p-4 bg-dark-950 rounded-xl border border-zinc-800 flex items-center justify-between group hover:border-brand/30 transition-colors">
            <div>
              <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-wider">Banco Guayaquil</p>
              <p class="text-white font-mono font-bold text-lg">0024419555</p>
              <p class="text-xs text-zinc-400">Ahorros - Luis Fernando Avilez Cevallos</p>
            </div>
            <button class="text-zinc-500 hover:text-white bg-dark-800 p-2 rounded-lg transition-colors" onclick="navigator.clipboard.writeText('0024419555'); alert('Copiado!')">
              <i class="far fa-copy"></i>
            </button>
          </div>
        </div>

        <div class="bg-yellow-500/10 p-3 rounded-lg border border-yellow-500/20 flex gap-3 items-start">
          <i class="fas fa-info-circle text-yellow-500 mt-0.5"></i>
          <p class="text-xs text-yellow-500/90">
            Una vez hecha la transferencia, confirma el pedido. Podrás subir el comprobante después en la sección "Mis Pedidos".
          </p>
        </div>

        <button onclick="confirmOrder()" id="btn-confirm-order"
          class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/20 transition-all flex items-center justify-center gap-2 active:scale-95">
          <span>Ya tengo los datos, Crear Pedido</span>
          <i class="fas fa-check-circle"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Floating cart -->
  <button id="floating-cart" class="hidden fixed bottom-8 right-8 z-50 bg-gradient-to-br from-brand to-rose-600 text-white w-16 h-16 rounded-full shadow-[0_0_20px_rgba(255,94,102,0.5)] flex items-center justify-center transition-all hover:scale-110 hover:-translate-y-1 active:scale-95 group border-4 border-dark-900/50 backdrop-blur-sm">
    <div class="relative">
      <i class="fas fa-shopping-cart text-2xl drop-shadow-md"></i>
      <span id="floatingCartCount" class="absolute -top-3 -right-3 bg-white text-brand text-xs font-bold h-6 w-6 flex items-center justify-center rounded-full shadow-lg border-2 border-brand transform scale-100 transition-transform group-hover:scale-110">0</span>
    </div>
  </button>

  <div id="promoModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
  <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closePromo()"></div>
  <div id="noti-modal-card" class="relative bg-dark-900 border-2 border-brand w-full max-w-lg rounded-[2.5rem] shadow-2xl overflow-hidden animate-fade-in">
    
    <div id="promo-content"></div>

    <div id="promo-timer" class="px-6 mb-4 hidden">
        <div class="bg-black/40 rounded-2xl p-4 border border-white/5 text-center">
            <p class="text-[10px] text-zinc-500 uppercase font-black tracking-widest mb-1">La oferta termina en</p>
            <div id="timer-display" class="text-2xl font-black font-mono text-white">00:00:00</div>
        </div>
    </div>
    
    <div class="p-6">
        <button id="noti-btn-action" onclick="markAsSeenAndClose()" class="w-full py-4 bg-brand text-white font-bold rounded-2xl shadow-lg">Entendido</button>
    </div>
  </div>
</div>
  <script>
   


    // UI
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    const cartModal = document.getElementById('cartModal');
    const globalModal = document.getElementById('globalModal');
    const body = document.body;

    hamburger.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });

    const disableScroll = () => body.classList.add('no-scroll', 'pr-[15px]');
    const enableScroll = () => body.classList.remove('no-scroll', 'pr-[15px]');

    const closeModals = () => {
      globalModal.classList.add('hidden');
      cartModal.classList.add('hidden');
      enableScroll();
    };

    document.querySelectorAll('.global-modal-close, .close-cart').forEach(btn => btn.addEventListener('click', closeModals));
    document.getElementById('modalOverlay').addEventListener('click', closeModals);
    document.getElementById('cartIcon').addEventListener('click', () => {
      cartModal.classList.remove('hidden');
      disableScroll();
    });

    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCGhcDEti7CWmFFx1iVU_wyKuqN4q2hYeQ",
      authDomain: "site-fullstreamrec.firebaseapp.com",
      projectId: "site-fullstreamrec",
      storageBucket: "site-fullstreamrec.appspot.com",
      messagingSenderId: "161679433276",
      appId: "1:161679433276:web:2ecedce7e76a33ecfe6d39"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Variables
    let cart = [];
    let productsCache = [];
    let currentUser = null;

    // ===== TELÉFONO ECUADOR (OBLIGATORIO) - FIX COMPLETO =====
    function normalizeEcuadorPhone(input) {
      let d = (input || "").replace(/\D/g, "");
      if (d.startsWith("593")) d = d.slice(3);
      if (d.length === 9 && d.startsWith("9")) d = "0" + d;
      if (d.length === 10 && d.startsWith("09")) return d;
      return null;
    }

    // Estado global para que onclick="closePhoneModal(false)" funcione SIEMPRE
    let __phoneModalResolver = null;

    window.closePhoneModal = (ok) => {
      const modal = document.getElementById("phoneModal");
      const input = document.getElementById("phoneInput");
      const btn = document.getElementById("btn-save-phone");

      if (modal) modal.classList.add("hidden");

      if (btn) {
        btn.disabled = false;
        btn.innerHTML = '<span>Guardar y continuar</span> <i class="fas fa-check-circle"></i>';
        btn.onclick = null;
      }

      if (input) input.onkeydown = null;

      if (__phoneModalResolver) {
        __phoneModalResolver(ok ? true : false);
        __phoneModalResolver = null;
      }
    };

    async function ensureUserPhone() {
      if (!currentUser) return null;

      try {
        const userRef = db.collection("users").doc(currentUser.uid);
        const snap = await userRef.get();
        const savedPhone = snap.exists ? (snap.data().phone || null) : null;
        const normalizedSaved = normalizeEcuadorPhone(savedPhone);
        if (normalizedSaved) return normalizedSaved;
      } catch (e) {
        console.error("No se pudo leer users/{uid}. Se pedirá teléfono igual.", e);
      }

      return await openPhoneModalAndWait();
    }

    function openPhoneModalAndWait() {
      return new Promise((resolve) => {
        const modal = document.getElementById("phoneModal");
        const input = document.getElementById("phoneInput");
        const err = document.getElementById("phoneError");
        const btn = document.getElementById("btn-save-phone");

        if (!modal || !input || !err || !btn) {
          console.error("Modal de teléfono: faltan elementos en el DOM");
          return resolve(null);
        }

        input.value = "";
        err.classList.add("hidden");
        modal.classList.remove("hidden");

        __phoneModalResolver = (ok) => {
          if (!ok) return resolve(null);
          // si ok, el resolve lo hace onSave con el número validado
        };

        const onSave = async () => {
          const normalized = normalizeEcuadorPhone(input.value);

          if (!normalized) {
            err.classList.remove("hidden");
            input.classList.add("border-red-500");
            setTimeout(() => input.classList.remove("border-red-500"), 1200);
            return;
          }

          try {
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

            await db.collection("users").doc(currentUser.uid).set(
              {
                phone: normalized,
                phoneE164: "+593" + normalized.slice(1),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
              },
              { merge: true }
            );

            window.closePhoneModal(true);
            __phoneModalResolver = null;
            return resolve(normalized);
          } catch (e) {
            console.error("Error guardando teléfono:", e);
            btn.disabled = false;
            btn.innerHTML = '<span>Guardar y continuar</span> <i class="fas fa-check-circle"></i>';
            alert("No se pudo guardar el teléfono. Revisa permisos/reglas y prueba de nuevo.");
          }
        };

        btn.onclick = onSave;
        input.onkeydown = (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            onSave();
          }
        };

        input.focus();
      });
    }

    function saveCart() {
      localStorage.setItem('fullstream_cart', JSON.stringify(cart));
    }

    function initCart() {
      const saved = localStorage.getItem('fullstream_cart');
      if (saved) {
        try {
          cart = JSON.parse(saved);
          updateCart();
        } catch (e) {
          console.error("Error cargando carrito", e);
          localStorage.removeItem('fullstream_cart');
        }
      }
    }

let heroProductsPool = [];
let currentHeroIndex = 0;

const loadHeroProducts = async () => {
  const container = document.getElementById('hero-products-container');
  if (!container) return;

  try {
    // Traemos productos de Firebase (limitamos a 10 para rotación)
    const snapshot = await db.collection('products')
      .where('visible', '==', true)
      .limit(10)
      .get();
    
    if (snapshot.empty) return;

    heroProductsPool = [];
    snapshot.forEach(doc => heroProductsPool.push({ id: doc.id, ...doc.data() }));

    // Iniciar el ciclo
    rotateValla();
    setInterval(rotateValla, 6000); // Cambia cada 6 segundos

  } catch (error) {
    console.error('Error en valla publicitaria:', error);
  }
};

function rotateValla() {
  const container = document.getElementById('hero-products-container');
  if (heroProductsPool.length === 0) return;

  // Seleccionamos el siguiente producto
  const product = heroProductsPool[currentHeroIndex];
  currentHeroIndex = (currentHeroIndex + 1) % heroProductsPool.length;

  // 1. Animación de salida (si ya hay algo)
  const oldCard = container.querySelector('.valla-card');
  if (oldCard) {
    oldCard.classList.add('valla-hidden');
  }

  // 2. Esperar a que la salida termine y renderizar el nuevo
  setTimeout(() => {
    const design = {
      border: 'border-brand/30',
      text: 'text-brand',
      glow: 'shadow-brand/20'
    };

    const price = (product.plans && product.plans.length > 0) ? product.plans[0].price : '$0.00';

    container.innerHTML = `
      <div class="valla-card valla-hidden bg-dark-800/60 border ${design.border} rounded-3xl p-5 backdrop-blur-xl shadow-2xl ${design.glow} relative overflow-hidden h-full flex items-center">
        <div class="led-glow"></div>
        <div class="flex items-center gap-5 w-full relative z-10">
          <div class="w-20 h-20 bg-dark-900 rounded-2xl flex items-center justify-center flex-shrink-0 border border-white/10 shadow-inner">
            <img src="${product.logo}" class="w-14 h-14 object-contain" onerror="this.src='logo.jpg'">
          </div>
          
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              
              <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-tighter">${product.category}</p>
            </div>
            <h4 class="font-black text-white text-lg truncate leading-tight uppercase">${product.name}</h4>
            <div class="flex items-end justify-between mt-2">
              <p class="${design.text} font-black text-2xl tracking-tighter">${price}</p>
              <button onclick="showCatalogModal()" class="bg-white text-dark-950 text-[10px] font-black px-4 py-2 rounded-xl hover:scale-105 transition-transform">
                ADQUIRIR <i class="fas fa-chevron-right ml-1"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    `;

    // 3. Quitar la clase hidden para que entre con la animación CSS
    setTimeout(() => {
      container.querySelector('.valla-card').classList.remove('valla-hidden');
    }, 50);
  }, 800);
}

// Función helper para asignar iconos según categoría
const getIconForProduct = (category) => {
  const cat = category?.toLowerCase() || '';
  if (cat.includes('streaming') || cat.includes('video')) return 'play';
  if (cat.includes('musica') || cat.includes('spotify')) return 'music';
  if (cat.includes('videojuegos') || cat.includes('gaming') || cat.includes('fire')) return 'gamepad';
  if (cat.includes('iptv') || cat.includes('tv')) return 'tv';
  if (cat.includes('herramientas') || cat.includes('creativas')) return 'pen-nib';
  return 'sparkles';
};

    
    window.loginWithGoogle = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          console.log("Login:", result.user.displayName);
        }).catch((error) => {
          console.error("Error login:", error);
          alert("Error al iniciar sesión: " + error.message);
        });
    };

    window.showCatalogModal = () => {
  if (currentUser) {
    // Ya está logueado, desplazar al catálogo
    document.getElementById('products-container').scrollIntoView({ behavior: 'smooth' });
  } else {
    // No está logueado, mostrar modal
    const modal = document.createElement('div');
    modal.id = 'catalog-modal';
    modal.className = 'fixed inset-0 z-[100] flex items-center justify-center p-4';
    modal.innerHTML = `
      <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="document.getElementById('catalog-modal').remove()"></div>
      <div class="relative bg-dark-900 border border-zinc-700 w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-fade-in">
        <div class="bg-brand/10 p-6 text-center border-b border-white/5">
          <div class="w-16 h-16 bg-brand rounded-full flex items-center justify-center mx-auto mb-4 text-white text-2xl shadow-lg shadow-brand/30">
            <i class="fas fa-lock"></i>
          </div>
          <h3 class="text-2xl font-black text-white">Visualiza el Catálogo</h3>
          <p class="text-zinc-400 text-sm mt-2">Inicia sesión para explorar todos nuestros productos y precios</p>
        </div>

        <div class="p-6 space-y-4">
          <div class="bg-dark-950 p-4 rounded-xl border border-zinc-800 flex items-start gap-3">
            <i class="fas fa-check-circle text-brand text-lg mt-1 flex-shrink-0"></i>
            <div>
              <p class="text-white font-bold text-sm">Ofertas Exclusivas</p>
              <p class="text-zinc-400 text-xs">Accede a descuentos especiales</p>
            </div>
          </div>

          <div class="bg-dark-950 p-4 rounded-xl border border-zinc-800 flex items-start gap-3">
            <i class="fas fa-check-circle text-brand text-lg mt-1 flex-shrink-0"></i>
            <div>
              <p class="text-white font-bold text-sm">Entrega Inmediata</p>
              <p class="text-zinc-400 text-xs">Recibe tu acceso en segundos</p>
            </div>
          </div>

          <div class="bg-dark-950 p-4 rounded-xl border border-zinc-800 flex items-start gap-3">
            <i class="fas fa-check-circle text-brand text-lg mt-1 flex-shrink-0"></i>
            <div>
              <p class="text-white font-bold text-sm">Soporte 24/7</p>
              <p class="text-zinc-400 text-xs">Estamos siempre disponibles</p>
            </div>
          </div>
        </div>

        <div class="p-6 border-t border-white/5 space-y-3">
          <button onclick="loginWithGoogle(); document.getElementById('catalog-modal').remove();" class="w-full py-3 bg-white hover:bg-zinc-200 text-dark-950 font-bold rounded-xl flex items-center justify-center gap-3 transition-all shadow-lg shadow-white/10">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Google">
            <span>Acceder con Google</span>
          </button>

          <button onclick="document.getElementById('catalog-modal').remove()" class="w-full py-3 bg-dark-800 hover:bg-dark-700 text-zinc-300 font-bold rounded-xl border border-zinc-700 transition-all">
            Cancelar
          </button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);
  }
};


    window.logout = () => {
      auth.signOut().then(() => {
        window.location.reload();
      });
    };

    auth.onAuthStateChanged(user => {
      const userMenu = document.getElementById('user-menu');
      const guestMenu = document.getElementById('guest-menu');
      const userPhoto = document.getElementById('user-photo');
      const mainNav = document.getElementById('main-nav');
      const mobileOrdersBtn = document.getElementById('mobile-orders-btn');
      const mobileNavLinks = document.getElementById('mobile-nav-links');
      const mobileGuestBtn = document.getElementById('mobile-guest-btn');
      const mobileLogoutBtn = document.getElementById('mobile-logout-btn');

      const heroButtons = document.getElementById('hero-buttons');
      const searchContainer = document.getElementById('search-container');
      const footer = document.getElementById('main-footer');
      const headerCart = document.getElementById('cartIcon');
      const floatingCart = document.getElementById('floating-cart');
      const heroTitle = document.getElementById('hero-title');
      const heroDesc = document.getElementById('hero-desc');
      const heroStats = document.getElementById('hero-stats');

      if (user) {
        currentUser = user;
        const firstName = user.displayName ? user.displayName.split(' ')[0] : 'Amigo';
        if (heroStats) heroStats.classList.add('hidden');
        if (heroTitle) heroTitle.innerHTML = `Hola, ${firstName} <br/> <span class="bg-clip-text text-transparent bg-gradient-to-r from-brand via-brand-light to-orange-400">Qué bueno verte</span>`;
        if (heroDesc) heroDesc.textContent = "Tu catálogo exclusivo está listo. Explora las mejores ofertas que tenemos para ti hoy.";

        if (mainNav) { mainNav.classList.remove('md:flex'); mainNav.classList.add('hidden'); }
        guestMenu.classList.add('hidden');
        userMenu.classList.remove('hidden');
        userMenu.classList.add('flex');
        userPhoto.src = user.photoURL || 'logo.jpg';

        if (mobileNavLinks) mobileNavLinks.classList.add('hidden');
        if (mobileGuestBtn) mobileGuestBtn.classList.add('hidden');
        if (mobileLogoutBtn) mobileLogoutBtn.classList.remove('hidden');
        if (mobileOrdersBtn) mobileOrdersBtn.classList.remove('hidden');

        if (searchContainer) searchContainer.classList.remove('hidden');
        if (heroButtons) heroButtons.classList.add('opacity-0', 'pointer-events-none');

        if (footer) footer.classList.add('hidden');
        if (headerCart) headerCart.classList.remove('hidden');
        if (floatingCart) {
          floatingCart.classList.remove('hidden');
          floatingCart.onclick = () => {
            document.getElementById('cartModal').classList.remove('hidden');
            document.body.classList.add('no-scroll');
          };
        }

        renderSkeleton();
        loadProducts();
        
      } else {
        if (heroStats) heroStats.classList.remove('hidden');
        if (heroTitle) heroTitle.innerHTML = `Entretenimiento <br/> <span class="bg-clip-text text-transparent bg-gradient-to-r from-brand via-brand-light to-orange-400">Al Mejor Precio</span>`;
        if (heroDesc) heroDesc.textContent = "Accede a Netflix, Disney+, Spotify, IPTV y recargas gamer en segundos.";

        if (mainNav) {
          mainNav.classList.add('hidden');
          mainNav.classList.add('md:flex');
        }

        guestMenu.classList.remove('hidden');
        userMenu.classList.add('hidden');

        if (mobileNavLinks) mobileNavLinks.classList.remove('hidden');
        if (mobileGuestBtn) mobileGuestBtn.classList.remove('hidden');
        if (mobileLogoutBtn) mobileLogoutBtn.classList.add('hidden');
        if (mobileOrdersBtn) mobileOrdersBtn.classList.add('hidden');

        if (searchContainer) searchContainer.classList.add('hidden');
        if (heroButtons) heroButtons.classList.remove('opacity-0', 'pointer-events-none');

        if (footer) footer.classList.remove('hidden');
        if (headerCart) headerCart.classList.add('hidden');
        if (floatingCart) floatingCart.classList.add('hidden');

        renderLockedCatalog();
      }
    });

    function renderSkeleton() {
      const container = document.getElementById("products-container");
      const skeletonCard = `
        <div class="carousel-card skeleton-card">
          <div class="bg-dark-900/60 border border-white/5 rounded-2xl p-4 h-[320px] flex flex-col">
            <div class="h-32 bg-dark-800/50 rounded-xl mb-4"></div>
            <div class="h-4 bg-dark-700/50 rounded w-3/4 mx-auto mb-2"></div>
            <div class="h-3 bg-dark-800/50 rounded w-1/2 mx-auto mb-4"></div>
            <div class="mt-auto h-10 bg-brand/30 rounded-xl"></div>
          </div>
        </div>
      `;

      const skeletonCategory = (name) => `
        <div class="mb-16">
          <div class="flex items-center justify-between mb-6 px-6">
            <h2 class="text-2xl font-bold text-white">${name}</h2>
            <div class="flex gap-2">
              <div class="w-8 h-8 bg-dark-800 rounded-full"></div>
              <div class="w-8 h-8 bg-dark-800 rounded-full"></div>
            </div>
          </div>
          <div class="carousel-container">${skeletonCard.repeat(6)}</div>
        </div>
      `;

      container.innerHTML =
        skeletonCategory('Streaming de Video') +
        skeletonCategory('Videojuegos') +
        skeletonCategory('Música');
    }

  function renderLockedCatalog() {
  const container = document.getElementById("products-container");
  
  container.innerHTML = `
    <div class="marquee-container relative overflow-hidden py-12 mb-12 border-y border-white/5 bg-white/[0.01] backdrop-blur-sm animate-fade-in">
      <div class="absolute inset-0 z-10 pointer-events-none bg-gradient-to-r from-dark-950 via-transparent to-dark-950"></div>

      <div class="animate-marquee flex items-center">
        <div class="flex items-center gap-16 md:gap-32 px-12">
          <img src="https://upload.wikimedia.org/wikipedia/commons/0/08/Netflix_2015_logo.svg" 
               class="h-7 md:h-9 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg" 
               class="h-9 md:h-12 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://upload.wikimedia.org/wikipedia/commons/2/26/Spotify_logo_with_text.svg" 
               class="h-7 md:h-9 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://upload.wikimedia.org/wikipedia/commons/1/11/Amazon_Prime_Video_logo.svg" 
               class="h-7 md:h-9 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://logodownload.org/wp-content/uploads/2022/12/hbo-max-logo.png" 
               class="h-5 md:h-7 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://i.pinimg.com/originals/bb/83/cb/bb83cb10d8f0243da96cb65d3c691381.png" 
               class="h-9 md:h-12 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
        </div>

        <div class="flex items-center gap-16 md:gap-32 px-12">
          <img src="https://upload.wikimedia.org/wikipedia/commons/0/08/Netflix_2015_logo.svg" 
               class="h-7 md:h-9 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg" 
               class="h-9 md:h-12 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://upload.wikimedia.org/wikipedia/commons/2/26/Spotify_logo_with_text.svg" 
               class="h-7 md:h-9 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://upload.wikimedia.org/wikipedia/commons/1/11/Amazon_Prime_Video_logo.svg" 
               class="h-7 md:h-9 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://logodownload.org/wp-content/uploads/2022/12/hbo-max-logo.png" 
               class="h-5 md:h-7 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
          <img src="https://i.pinimg.com/originals/bb/83/cb/bb83cb10d8f0243da96cb65d3c691381.png" 
               class="h-9 md:h-12 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-500">
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-16 animate-fade-in">
      <div class="group p-8 rounded-[2rem] bg-dark-900/50 border border-white/5 flex flex-col items-center text-center hover:border-brand/30 transition-all duration-500">
        <div class="w-14 h-14 bg-brand/10 rounded-2xl flex items-center justify-center text-brand mb-6 group-hover:scale-110 transition-transform">
          <i class="fas fa-bolt text-2xl"></i>
        </div>
        <h3 class="text-white font-bold text-lg mb-2">Activación Instantánea</h3>
        <p class="text-zinc-500 text-sm leading-relaxed">Recibe tus credenciales tras confirmar tu pago.</p>
      </div>

      <div class="group p-8 rounded-[2rem] bg-dark-900/50 border border-white/5 flex flex-col items-center text-center hover:border-blue-500/30 transition-all duration-500">
        <div class="w-14 h-14 bg-blue-500/10 rounded-xl flex items-center justify-center text-blue-500 mb-6 group-hover:scale-110 transition-transform">
          <i class="fas fa-shield-alt text-2xl"></i>
        </div>
        <h3 class="text-white font-bold text-lg mb-2">Soporte</h3>
        <p class="text-zinc-500 text-sm leading-relaxed">Asistencia personalizada por WhatsApp para cualquier inconveniente.</p>
      </div>

      <div class="group p-8 rounded-[2rem] bg-dark-900/50 border border-white/5 flex flex-col items-center text-center hover:border-green-500/30 transition-all duration-500">
        <div class="w-14 h-14 bg-green-500/10 rounded-xl flex items-center justify-center text-green-500 mb-6 group-hover:scale-110 transition-transform">
          <i class="fas fa-wallet text-2xl"></i>
        </div>
        <h3 class="text-white font-bold text-lg mb-2">Pago Seguro</h3>
        <p class="text-zinc-500 text-sm leading-relaxed">Aceptamos transferencias de los principales bancos de Ecuador.</p>
      </div>
    </div>
  `;
}


    function loadProducts() {
      const CACHE_KEY = 'fullstream_products_cache';
      const cachedData = localStorage.getItem(CACHE_KEY);
      if (cachedData) {
        try {
          const parsed = JSON.parse(cachedData);
          if (parsed.products && parsed.products.length > 0) {
            console.log("⚡ Cargando desde caché local...");
            productsCache = parsed.products;
            renderCarouselCatalog(productsCache);
          }
        } catch (e) {
          console.error("Error leyendo caché local:", e);
          localStorage.removeItem(CACHE_KEY);
        }
      }

      db.collection("products")
        .where("visible", "in", [true, null])
        .onSnapshot((snapshot) => {
          const freshProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          productsCache = freshProducts;
          renderCarouselCatalog(productsCache);

          localStorage.setItem(CACHE_KEY, JSON.stringify({
            timestamp: Date.now(),
            products: freshProducts
          }));

          const searchVal = document.getElementById('searchInput').value;
          if (searchVal.trim() !== '') {
            const event = new Event('input');
            document.getElementById('searchInput').dispatchEvent(event);
          }
          console.log("☁️ Catálogo sincronizado con Firebase");
        }, (error) => {
          console.error("Error obteniendo productos de Firebase:", error);
        });
    }

    function renderCarouselCatalog(productsList) {
      const container = document.getElementById("products-container");
      container.innerHTML = '';
      if (productsList.length === 0) {
        container.innerHTML = `<div class="text-center py-20 text-zinc-500 text-xl">No se encontraron productos.</div>`;
        return;
      }

      const categories = ["Streaming de Video", "IPTV", "Música", "Videojuegos", "Herramientas Creativas", "Combos"];

      categories.forEach((catName) => {
        const products = productsList.filter(p => p.category === catName);
        if (products.length === 0) return;

        const section = document.createElement('div');
        section.className = 'mb-16 animate-fade-in';
        section.innerHTML = `
          <div class="flex items-center justify-between mb-6 px-6">
            <h2 class="text-2xl md:text-3xl font-bold text-white flex items-center gap-3">
              <span class="bg-clip-text text-transparent bg-gradient-to-r from-white to-zinc-400">${catName}</span>
            </h2>
          </div>
          <div class="carousel-container" id="carousel-${catName.replace(/\s+/g, '-')}"></div>
        `;

        const carousel = section.querySelector('.carousel-container');

        products.forEach(p => {
          const card = document.createElement('div');
          card.className = "carousel-card";
          card.innerHTML = `
            <div class="bg-dark-900/60 backdrop-blur-md border border-white/5 rounded-2xl p-4 hover:border-brand/40 shadow-xl hover:shadow-brand/20 transition-all duration-300 hover:-translate-y-1 h-full flex flex-col group cursor-pointer relative">
              ${p.isPopular ? `<div class="absolute top-2 right-2 bg-brand text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-10 flex items-center gap-1"><i class="fas fa-star text-[8px]"></i> Popular</div>` : ''}
              <div class="relative h-28 mb-4 flex items-center justify-center bg-dark-800 rounded-xl p-3 group-hover:bg-dark-700 transition-all">
                <img src="${p.logo}" alt="${p.name}" class="h-full w-auto object-contain group-hover:scale-110 transition-transform duration-300" onerror="this.src='https://fakeimg.pl/200x200?text=No+Img'">
              </div>
              <h3 class="text-lg font-bold text-white mb-1 text-center leading-tight">${p.name}</h3>
              <p class="text-zinc-400 text-xs text-center mb-4 line-clamp-2">${p.subtitle || '&nbsp;'}</p>
              <button class="mt-auto w-full py-2.5 rounded-xl bg-gradient-to-r from-brand to-brand-light text-white text-sm font-bold hover:shadow-lg hover:shadow-brand/40 transition-all active:scale-95 flex items-center justify-center gap-2">
                <i class="fas fa-tags text-xs"></i> Ver Planes
              </button>
            </div>
          `;
          card.onclick = () => showPlans(p);
          carousel.appendChild(card);
        });

        container.appendChild(section);
      });
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      if (term.trim() === '') { renderCarouselCatalog(productsCache); return; }
      const filtered = productsCache.filter(p =>
        p.name.toLowerCase().includes(term) ||
        (p.subtitle && p.subtitle.toLowerCase().includes(term)) ||
        p.category.toLowerCase().includes(term)
      );
      renderCarouselCatalog(filtered);
    });

    const parsePrice = (str) => parseFloat((str || '').replace(/[^\d.]/g, '')) || 0;
    const formatPrice = (num) => num.toLocaleString('es-EC', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 });

    function updateCart() {
      const count = cart.length;
      const headerCountEl = document.getElementById('cartCount');
      if (headerCountEl) headerCountEl.textContent = count;

      const floatCountEl = document.getElementById('floatingCartCount');
      if (floatCountEl) floatCountEl.textContent = count;

      const container = document.getElementById('cartItems');
      const totalEl = document.getElementById('cartTotal');
      const checkoutBtn = document.getElementById('btn-process-checkout');

      if (cart.length === 0) {
        container.innerHTML = `<div class="flex flex-col items-center justify-center h-64 text-zinc-500"><i class="fas fa-shopping-basket text-6xl mb-4 opacity-20"></i><p>Tu carrito está vacío</p></div>`;
        checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
        checkoutBtn.disabled = true;
      } else {
        checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        checkoutBtn.disabled = false;

        container.innerHTML = cart.map((item, i) => `
          <div class="flex items-start gap-4 bg-dark-800 p-3 rounded-lg border border-zinc-700/50">
            <img src="${item.productImage}" class="w-16 h-16 object-contain bg-dark-900 rounded p-1">
            <div class="flex-1 min-w-0">
              <h4 class="font-bold text-white truncate">${item.productName}</h4>
              <p class="text-sm text-zinc-400">${item.planName}</p>
              <p class="text-brand font-bold mt-1">${item.planPrice}</p>
            </div>
            <button onclick="removeFromCart(${i})" class="text-zinc-500 hover:text-red-500 transition-colors p-1"><i class="fas fa-trash"></i></button>
          </div>
        `).join('');
      }

      const total = cart.reduce((acc, item) => acc + parsePrice(item.planPrice), 0);
      totalEl.textContent = formatPrice(total);
    }

    window.removeFromCart = (index) => {
      cart.splice(index, 1);
      saveCart();
      updateCart();
    };

    window.addToCart = (productId, productName, planName, planPrice, img) => {
      cart.push({ productId, productName, planName, planPrice, productImage: img });
      saveCart();
      updateCart();
      cartModal.classList.remove('hidden');
      disableScroll();
    };

    function showPlans(product) {
  const modal = document.getElementById('globalModal');
  const container = document.getElementById('global-plans-container');
  
  // Actualizar imagen y título del modal
  document.getElementById('global-modal-logo').src = product.logo;
  document.getElementById('global-modal-title').textContent = product.name;
  container.innerHTML = '';

  // 1. LÓGICA DE FORMULARIO DINÁMICO
  // Leemos la configuración del producto (si no tiene, asumimos 'none')
  const inputType = product.inputType || 'none';
  let formHtml = '';

  if (product.name.toLowerCase().includes('free fire') || inputType === 'text') {
    // CASO 1: Pide solo un dato (ID, Tag, Número)
    // Mantenemos la compatibilidad con tu código anterior de Free Fire
    formHtml = `
      <div class="mb-4 bg-dark-800 p-4 rounded-lg border border-zinc-700 animate-fade-in">
        <label class="block text-xs font-bold text-zinc-400 uppercase mb-2">
            ${product.name.toLowerCase().includes('free fire') ? 'ID de Jugador' : 'ID / Usuario / Tag'}
        </label>
        <input type="text" id="req-input-1" placeholder="Ingresa el dato aquí" class="w-full bg-dark-900 border border-zinc-600 rounded p-3 text-white focus:border-brand focus:outline-none">
      </div>
    `;
  } else if (inputType === 'credentials') {
    // CASO 2: Pide Usuario y Contraseña
    formHtml = `
      <div class="mb-4 bg-dark-800 p-4 rounded-lg border border-zinc-700 animate-fade-in space-y-3">
        <div>
          <label class="block text-xs font-bold text-zinc-400 uppercase mb-1">Correo / Usuario</label>
          <input type="text" id="req-input-1" placeholder="ejemplo@correo.com" class="w-full bg-dark-900 border border-zinc-600 rounded-xl p-3 text-white focus:border-brand focus:outline-none">
        </div>
        <div>
          <label class="block text-xs font-bold text-zinc-400 uppercase mb-1">Contraseña</label>
          <div class="relative">
            <input type="text" id="req-input-2" placeholder="Tu contraseña" class="w-full bg-dark-900 border border-zinc-600 rounded-xl p-3 text-white focus:border-brand focus:outline-none">
            <p class="text-[10px] text-zinc-500 mt-1"><i class="fas fa-lock"></i> Datos encriptados.</p>
          </div>
        </div>
      </div>
    `;
  }

  // Insertar el formulario en el contenedor si es necesario
  if (formHtml) {
    const formDiv = document.createElement('div');
    formDiv.innerHTML = formHtml;
    container.appendChild(formDiv);
  }

  // 2. RENDERIZAR LOS PLANES
  product.plans.forEach(plan => {
    const img = plan.image || product.logo;
    const btn = document.createElement('button');
    btn.className = "w-full bg-dark-800 hover:bg-dark-700 border border-zinc-700 hover:border-green-500/50 rounded-xl p-4 flex items-center justify-between group transition-all mb-2";
    
    btn.innerHTML = `
      <div class="flex items-center gap-4">
        <img src="${img}" class="w-10 h-10 object-contain">
        <div class="text-left">
          <p class="font-bold text-white group-hover:text-white transition-colors">${plan.name}</p>
        </div>
      </div>
      <span class="font-bold text-green-500 bg-green-500/10 px-3 py-1 rounded-lg">${plan.price}</span>
    `;

    // 3. LÓGICA DEL CLIC (VALIDACIÓN Y CARRITO)
    btn.onclick = () => {
      let finalPlanName = plan.name;
      let additionalInfo = "";

      // Validamos según el tipo de formulario mostrado
      if (document.getElementById('req-input-1')) {
        const val1 = document.getElementById('req-input-1').value.trim();
        
        // Si hay un segundo input (contraseña), validamos ambos
        if (document.getElementById('req-input-2')) {
           const val2 = document.getElementById('req-input-2').value.trim();
           if (val1.length < 3 || val2.length < 3) {
             alert("Por favor completa usuario y contraseña.");
             return;
           }
           additionalInfo = ` (C: ${val1} | P: ${val2})`;
        } else {
           // Si solo hay un input (ID)
           if (val1.length < 3) {
             const input = document.getElementById('req-input-1');
             input.classList.add('border-red-500', 'animate-pulse');
             setTimeout(() => input.classList.remove('border-red-500', 'animate-pulse'), 2000);
             return;
           }
           additionalInfo = ` (ID: ${val1})`;
        }
      }

      // Agregamos la info extra al nombre para que salga en el pedido
      finalPlanName += additionalInfo;

      // Enviamos al carrito
      addToCart(product.id, product.name, finalPlanName, plan.price, img);
      
      // Cerramos modal
      document.getElementById('globalModal').classList.add('hidden');
      document.body.classList.remove('no-scroll');
    };

    container.appendChild(btn);
  });

  modal.classList.remove('hidden');
  document.body.classList.add('no-scroll');
}

    async function openPaymentModal() {
      if (cart.length === 0) return alert("El carrito está vacío");
      if (!currentUser) { loginWithGoogle(); return; }

      const phone = await ensureUserPhone();
      if (!phone) return;

      document.getElementById("cartModal").classList.add("hidden");
      document.getElementById("paymentModal").classList.remove("hidden");
    }

    async function confirmOrder() {
      const btn = document.getElementById('btn-confirm-order');
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creando...';

      try {
        const phone = await ensureUserPhone();
        if (!phone) {
          btn.disabled = false;
          btn.innerHTML = "Intentar de nuevo";
          return;
        }

        const total = cart.reduce((acc, item) => acc + parseFloat((item.planPrice || '').replace(/[^\d.]/g, '')), 0);
        const orderData = {
          userPhone: phone,
          userPhoneE164: "+593" + phone.slice(1),
          userId: currentUser.uid,
          userName: currentUser.displayName || 'Cliente',
          userEmail: currentUser.email,
          items: cart,
          total: total,
          totalFormatted: `$${total.toFixed(2)}`,
          status: 'Pendiente',
          date: firebase.firestore.FieldValue.serverTimestamp(),
          platform: 'Web',
          paymentData: null,
          deliveryData: null
        };

        const docRef = await db.collection('orders').add(orderData);

        const itemsResumen = cart.map(i => `- ${i.productName} (${i.planName})`).join('\n');
        const waNumber = "593" + phone.slice(1);

        const mensaje = `
🚨 <b>NUEVO PEDIDO RECIBIDO</b> 🚨

👤 <b>Cliente:</b> ${currentUser.displayName || 'Anonimo'}
📧 <b>Email:</b> ${currentUser.email}
📱 <b>WhatsApp:</b> +593 ${phone.slice(1)}
💰 <b>Total:</b> ${orderData.totalFormatted}
🆔 <b>ID Pedido:</b> <code>${docRef.id}</code>

🛒 <b>Productos:</b>
${itemsResumen}

👇 <b>Acciones:</b>
<a href="https://wa.me/${waNumber}?text=Hola,%20vi%20tu%20pedido%20${docRef.id}%20en%20FullStreamRec">Contactar Cliente</a>
`;

        // enviarNotificacionTelegram(mensaje);

        cart = [];
        saveCart();
        updateCart();
        document.getElementById('paymentModal').classList.add('hidden');
        document.body.classList.remove('no-scroll');
        window.location.href = 'mis-pedidos.html';
      } catch (error) {
        console.error("Error al crear pedido:", error);
        alert("Hubo un error al procesar el pedido. Intenta de nuevo.");
        btn.disabled = false;
        btn.innerText = "Intentar de nuevo";
      }
    }

    function closePromo() {
    document.getElementById('promoModal').classList.add('hidden');
    document.body.classList.remove('no-scroll');
}

let countdownInterval = null; // Variable global para el contador
let notificationListener = null;

function initNotificationRealTime() {
    if (notificationListener) notificationListener(); 

    notificationListener = db.collection('settings').doc('notification').onSnapshot((doc) => {
        if (!doc.exists) return;
        const data = doc.data();
        const modal = document.getElementById('promoModal');
        const modalCard = document.getElementById('noti-modal-card');
        const actionBtn = document.getElementById('noti-btn-action');

        if (!data.enabled) {
            closePromo();
            return;
        }

        // --- PUNTO 4: CONFIGURACIÓN DE NIVELES (COLORES E ÍCONOS) ---
        const levels = {
            promo: { color: '#ff5e66', icon: 'fa-fire' },         // Rojo Marca
            info: { color: '#3b82f6', icon: 'fa-info-circle' },   // Azul
            mantenimiento: { color: '#f59e0b', icon: 'fa-tools' }, // Amarillo
            urgente: { color: '#ef4444', icon: 'fa-exclamation-triangle' } // Rojo Crítico
        };
        const config = levels[data.level || 'promo'];

        // Aplicar estilos dinámicos al modal y botón
        modalCard.style.borderColor = config.color;
        actionBtn.style.backgroundColor = config.color;

        const currentNotiId = data.updatedAt ? data.updatedAt.toMillis().toString() : data.title;
        const lastSeenNoti = sessionStorage.getItem('last_promo_id');

        if (lastSeenNoti === currentNotiId) return;

        // --- RENDERIZADO DINÁMICO ---
        const container = document.getElementById('promo-content');
        if (data.type === 'image') {
            container.innerHTML = `
                <img src="${data.imageUrl}" class="w-full h-64 object-cover" onerror="this.src='logo.jpg'">
                <div class="p-6 pb-2">
                    <h3 class="text-2xl font-black text-white mb-2">${data.title}</h3>
                    <p class="text-zinc-400 text-sm leading-relaxed">${data.message}</p>
                </div>
            `;
        } else {
            container.innerHTML = `
                <div class="p-8 pt-12 text-center">
                    <div class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-3xl" style="background-color: ${config.color}20; color: ${config.color}">
                        <i class="fas ${config.icon}"></i>
                    </div>
                    <h3 class="text-3xl font-black text-white mb-4">${data.title}</h3>
                    <p class="text-zinc-400 text-base leading-relaxed">${data.message}</p>
                </div>
            `;
        }

        // --- PUNTO 5: LÓGICA DEL CONTADOR REGRESIVO ---
        if (countdownInterval) clearInterval(countdownInterval);
        const timerContainer = document.getElementById('promo-timer');
        
        if (data.expiry) {
            timerContainer.classList.remove('hidden');
            const targetDate = new Date(data.expiry).getTime();

            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const dist = targetDate - now;

                if (dist < 0) {
                    clearInterval(countdownInterval);
                    timerContainer.classList.add('hidden');
                    return;
                }

                const h = Math.floor(dist / (1000 * 60 * 60));
                const m = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((dist % (1000 * 60)) / 1000);
                document.getElementById('timer-display').innerText = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        } else {
            timerContainer.classList.add('hidden');
        }

        window.markAsSeenAndClose = () => {
            sessionStorage.setItem('last_promo_id', currentNotiId);
            closePromo();
        };

        const closeButtons = modal.querySelectorAll('[onclick="closePromo()"]');
        closeButtons.forEach(btn => btn.setAttribute('onclick', 'markAsSeenAndClose()'));

        modal.classList.remove('hidden');
        document.body.classList.add('no-scroll');
    });
}

// Reemplaza el llamado final por este:
window.addEventListener('load', () => {
    initNotificationRealTime();
});

    initCart();
    loadHeroProducts();

  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    }
  </style>
</body>
</html>
